---
/**
 * Full-bleed hero using tokenized spacing and typography.
 * Backdrop: fixed and non-scrolling; z-0 (paired with page content lifted on index).
 * Fades out over ~1 viewport height.
 */
const srTitle = "Build sharp websites with Astro + Tailwind";
---
<section aria-labelledby="hero-heading" data-hero="super" class="relative w-full min-h-[100svh] flex items-start px-page py-hero">
  <!-- Foreground content container -->
  <div class="relative z-10 w-full max-w-content mx-auto grid auto-rows-min auto-cols-fr gap-x-gutter">
    <h1 id="hero-heading" class="sr-only">{srTitle}</h1>

    <div class="col-span-full">
      <p class="text-balance">
        <span class="block text-hero-title">Build sharp websites</span>
        <span class="block text-hero-subtitle">with Astro + Tailwind tokens</span>
      </p>
    </div>
  </div>

  <!-- Backdrop layer: fixed, non-scrolling; z-0 to avoid initial flash -->
  <div aria-hidden="true" data-hero-backdrop class="pointer-events-none fixed inset-0 z-0 overflow-hidden" style="opacity:1;will-change:opacity">
    <img
      src="/img/hero03.png"
      alt=""
      decoding="async"
      loading="eager"
      class="w-full h-full object-cover object-center select-none"
      draggable="false"
    />
  </div>

  <!-- CTA bar: near bottom on mobile; ~25svh from bottom on lg+ -->
  <div class="absolute inset-x-0 top-[calc(85svh-2rem)] lg:top-auto lg:bottom-[25svh] px-page z-20">
    <div class="w-full max-w-content mx-auto flex items-center justify-between gap-4">
      <a href="/health" class="pointer-events-auto inline-flex items-center gap-2 underline underline-offset-4 font-medium focus:outline-none focus:ring-2 focus:ring-offset-2">
        Open Health
      </a>
      <a href="/moodboard" class="pointer-events-auto inline-flex items-center gap-2 rounded-xl px-4 py-2 border focus:outline-none focus:ring-2 focus:ring-offset-2">
        Open Moodboard
      </a>
    </div>
  </div>

  <!-- Inline script: fade backdrop opacity based on scroll progress -->
  <script is:inline>
    (function () {
      try {
        if (window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches) return;
      } catch (_) {}

      var hero = document.querySelector('[data-hero="super"]');
      if (!hero) return;
      var backdrop = hero.querySelector("[data-hero-backdrop]");
      if (!backdrop) return;

      var distance = Math.max(window.innerHeight, 1); // fade over ~1 viewport height
      var ticking = false;

      function clamp01(v){ return v < 0 ? 0 : v > 1 ? 1 : v; }

      function progress() {
        var y = window.scrollY || window.pageYOffset || 0;
        var start = hero.offsetTop || 0;
        var scrolled = Math.max(0, y - start);
        return clamp01(scrolled / distance);
      }

      function apply() {
        var p = progress();
        backdrop.style.opacity = String(1 - p);
      }

      function onScroll() {
        if (ticking) return;
        ticking = true;
        requestAnimationFrame(function(){ apply(); ticking = false; });
      }

      function onResize() {
        distance = Math.max(window.innerHeight, 1);
        apply();
      }

      apply();
      window.addEventListener("scroll", onScroll, { passive: true });
      window.addEventListener("resize", onResize);
    })();
  </script>
</section>
